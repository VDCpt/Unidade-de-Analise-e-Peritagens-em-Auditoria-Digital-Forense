<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="VDC Sistema de Peritagem Forense - M√≥dulo de An√°lise Financeira e Fiscal v12.7.2 RETA FINAL">
    <meta name="author" content="VDC Systems International">
    <title>VDC FORENSE ¬∑ v12.7.2 RETA FINAL</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî¨</text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body class="forensic-theme">

    <div id="loaderOverlay" class="loader-overlay hidden">
        <div class="loader-content">
            <div class="scanner-line"></div>
            <div class="loader-spinner"></div>
            <p id="loaderText">A PROCESSAR EVID√äNCIAS...</p>
            <div class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <div class="panoramic-bg"></div>
    <div class="laser-h"></div>
    <div class="laser-v"></div>

    <div class="app-container">
        
        <aside class="sidebar-forensic">
            <div class="sidebar-header">
                <div class="logo-area">
                    <span class="logo-icon">üî¨</span>
                    <div class="logo-text">
                        <h1>VDC <span class="accent">FORENSE</span></h1>
                        <span class="version-tag">v12.7.2 RETA FINAL</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-content">
                <section class="config-section">
                    <h3><i class="fas fa-id-card"></i> IDENTIFICA√á√ÉO DO SUJEITO</h3>
                    <div class="input-group">
                        <label>Nome da Entidade / Motorista</label>
                        <input type="text" id="clientName" placeholder="Ex: Jo√£o Silva ou Empresa Lda">
                    </div>
                    <div class="input-group">
                        <label>NIF / Identifica√ß√£o Fiscal</label>
                        <input type="text" id="clientNif" placeholder="000 000 000">
                    </div>
                    <div class="input-group">
                        <label>Plataforma de Origem</label>
                        <select id="platformSelect">
                            <option value="bolt">Bolt Operations O√ú</option>
                            <option value="uber">Uber B.V.</option>
                            <option value="free">Outra / Manual</option>
                        </select>
                    </div>
                </section>

                <section class="config-section">
                    <h3><i class="fas fa-sliders-h"></i> PAR√ÇMETROS TEMPORAIS</h3>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Ano Fiscal</label>
                            <input type="number" id="fiscalYear" value="2024">
                        </div>
                        <div class="input-group">
                            <label>Per√≠odo</label>
                            <select id="fiscalPeriod">
                                <option value="1s">1¬∫ Semestre</option>
                                <option value="2s" selected>2¬∫ Semestre</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                    </div>
                </section>

                <div class="sidebar-actions">
                    <button id="analyzeBtn" class="btn-primary pulse" disabled>
                        <i class="fas fa-microscope"></i> EXECUTAR AN√ÅLISE CRUZADA
                    </button>
                    <button id="resetBtn" class="btn-outline">
                        <i class="fas fa-undo"></i> REINICIAR SISTEMA
                    </button>
                </div>

                <div class="session-info">
                    <div class="info-row">
                        <span>ID SESS√ÉO:</span>
                        <span id="sessionID" class="mono-value">---</span>
                    </div>
                    <div class="info-row">
                        <span>HASH MESTRE:</span>
                        <span id="masterHash" class="mono-value">---</span>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-dashboard">
            
            <header class="dashboard-header">
                <div class="header-left">
                    <h2>PAINEL DE CONTROLO DE EVID√äNCIAS</h2>
                    <p class="subtitle">Cruzamento de dados SAF-T, Aplica√ß√µes e Documenta√ß√£o Banc√°ria</p>
                </div>
                <div class="header-right">
                    <div class="status-badge" id="systemStatus">
                        <span class="status-dot green"></span>
                        SISTEMA PRONTO
                    </div>
                </div>
            </header>

            <section class="upload-grid">
                <div class="drop-zone" id="drop-saft" data-type="saft">
                    <input type="file" id="file-saft" multiple accept=".xml" class="file-input">
                    <div class="drop-zone-content">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <h4>FICHEIROS SAF-T</h4>
                        <p>Arraste ficheiros .xml aqui</p>
                        <div class="file-counter" id="count-saft">0 ficheiros</div>
                    </div>
                </div>

                <div class="drop-zone" id="drop-statements" data-type="statements">
                    <input type="file" id="file-statements" multiple accept=".pdf,.csv" class="file-input">
                    <div class="drop-zone-content">
                        <i class="fas fa-university"></i>
                        <h4>EXTRATOS BANC√ÅRIOS</h4>
                        <p>PDF ou CSV banc√°rio</p>
                        <div class="file-counter" id="count-statements">0 ficheiros</div>
                    </div>
                </div>

                <div class="drop-zone" id="drop-invoices" data-type="invoices">
                    <input type="file" id="file-invoices" multiple accept=".pdf" class="file-input">
                    <div class="drop-zone-content">
                        <i class="fas fa-receipt"></i>
                        <h4>FATURAS / RELAT√ìRIOS APP</h4>
                        <p>PDFs faturados pela App</p>
                        <div class="file-counter" id="count-invoices">0 ficheiros</div>
                    </div>
                </div>

                <div class="drop-zone" id="drop-dac7" data-type="dac7">
                    <input type="file" id="file-dac7" multiple accept=".pdf,.png,.jpg,.jpeg" class="file-input">
                    <div class="drop-zone-content">
                        <i class="fas fa-shield-alt"></i>
                        <h4>DAC7 / OUTROS</h4>
                        <p>Comprovativos e Printscreens</p>
                        <div class="file-counter" id="count-dac7">0 ficheiros</div>
                    </div>
                </div>
            </section>

            <section class="kpi-grid">
                <div class="kpi-card" data-tooltip="Total bruto registado no SAF-T">
                    <div class="kpi-icon saft-color"><i class="fas fa-file-invoice"></i></div>
                    <div class="kpi-data">
                        <span class="kpi-label">SAF-T BRUTO</span>
                        <h3 id="valSaft">0,00 ‚Ç¨</h3>
                        <span class="kpi-subtext" id="subSaft">0 ficheiros processados</span>
                    </div>
                </div>

                <div class="kpi-card" data-tooltip="Ganhos totais extra√≠dos dos relat√≥rios da aplica√ß√£o">
                    <div class="kpi-icon app-color"><i class="fas fa-mobile-alt"></i></div>
                    <div class="kpi-data">
                        <span class="kpi-label">GANHOS APP</span>
                        <h3 id="valApp">0,00 ‚Ç¨</h3>
                        <span class="kpi-subtext" id="subApp">0 ficheiros processados</span>
                    </div>
                </div>

                <div class="kpi-card" data-tooltip="Valor total de impostos/IVA identificados">
                    <div class="kpi-icon tax-color"><i class="fas fa-percent"></i></div>
                    <div class="kpi-data">
                        <span class="kpi-label">COMISS√ïES / IVA</span>
                        <h3 id="valTax">0,00 ‚Ç¨</h3>
                        <span class="kpi-subtext" id="subTax">Calculado via algoritmos</span>
                    </div>
                </div>

                <div class="kpi-card highlight" data-tooltip="Diferen√ßa absoluta entre SAF-T e Ganhos Reais">
                    <div class="kpi-icon risk-color"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="kpi-data">
                        <span class="kpi-label">DISCREP√ÇNCIA</span>
                        <h3 id="valDiff">0,00 ‚Ç¨</h3>
                        <span class="kpi-subtext" id="subDiff">Margem de erro: 0%</span>
                    </div>
                </div>
            </section>

            <section class="analysis-area">
                <div class="chart-container card-forensic">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> TEND√äNCIA E CRUZAMENTO</h3>
                        <div class="chart-legend">
                            <span class="legend-item"><i class="dot saft"></i> SAF-T</span>
                            <span class="legend-item"><i class="dot app"></i> APP</span>
                        </div>
                    </div>
                    <canvas id="forensicChart"></canvas>
                </div>

                <div class="log-container card-forensic">
                    <div class="card-header">
                        <h3><i class="fas fa-terminal"></i> LOG DE AUDITORIA (VDC-CORE)</h3>
                        <button id="clearLog" class="btn-text">LIMPAR</button>
                    </div>
                    <div id="forensicLog" class="log-output">
                        <div class="log-entry system">SISTEMA INICIALIZADO: AGUARDANDO EVID√äNCIAS...</div>
                    </div>
                </div>
            </section>

            <section id="resultSection" class="results-grid hidden">
                <div class="verdict-card card-forensic">
                    <h3>VEREDICTO DE RISCO</h3>
                    <div id="verdictBadge" class="verdict-badge">PENDENTE</div>
                    <p id="verdictDescription">Insira dados para gerar o parecer t√©cnico autom√°tico.</p>
                </div>

                <div class="quantum-card card-forensic">
                    <h3>ESTIMATIVA DE QUANTUM (Art. 103¬∫ RGIT)</h3>
                    <div class="quantum-value" id="valQuantum">0,00 ‚Ç¨</div>
                    <p class="quantum-note">* Estimativa baseada na extrapola√ß√£o de 7 anos conforme norma legal.</p>
                    <button id="downloadReport" class="btn-secondary">
                        <i class="fas fa-file-pdf"></i> GERAR PARECER T√âCNICO (PDF)
                    </button>
                </div>
            </section>
        </main>
    </div>

    <div id="fileModal" class="modal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h3><i class="fas fa-folder-open"></i> EVID√äNCIAS NO CONTENTOR</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="file-list-container">
                    <table class="forensic-table">
                        <thead>
                            <tr>
                                <th>NOME DO FICHEIRO</th>
                                <th>TIPO</th>
                                <th>TAMANHO</th>
                                <th>STATUS</th>
                                <th>A√á√ïES</th>
                            </tr>
                        </thead>
                        <tbody id="fileListBody">
                            </tbody>
                    </table>
                </div>

                <div class="summary-box">
                    <h4>RESUMO DA CARGA</h4>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">SAF-T</span>
                            <span id="summarySaft" class="summary-value">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">APP/FATURAS</span>
                            <span id="summaryInvoices" class="summary-value">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">EXTRATOS</span>
                            <span id="summaryStatements" class="summary-value">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">DAC7/OUTROS</span>
                            <span id="summaryDac7" class="summary-value">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">TOTAL</span>
                            <span id="summaryTotal" class="summary-value total">0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeAndSaveBtn" class="btn-primary">
                    <i class="fas fa-check-circle"></i> SELAR EVID√äNCIAS
                </button>
            </div>
        </div>
    </div>

    <div id="toastContainer"></div>

    <script>
        // Inicializa√ß√£o global para PDF.js
        window.pdfjsLib = window['pdfjs-dist/build/pdf'];
        if (window.pdfjsLib) {
            window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    <script src="script.js"></script>

</body>
</html>
